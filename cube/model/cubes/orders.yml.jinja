{% set model = dbt_model('orders') %}

cubes:
  - {{ model.as_cube() }}

    joins:
      - name: customers
        sql: "{CUBE.customer_id} = {customers.customer_id}"
        relationship: many_to_one

    dimensions:
      {{ model.as_dimensions() }}
      
      - name: order_id
        sql: order_id
        type: number
        primary_key: true
        shown: true

    measures:
      - name: count
        type: count
        description: "Count of orders"
        public: {{ COMPILE_CONTEXT.securityContext.tenant_id == 888 }}

    pre_aggregations:
      - name: main
        measures:
          - count